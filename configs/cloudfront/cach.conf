# Set a variable to 1 if the "wordpress_logged_in_" cookie is found.
# This should be placed in the http or server block, but is here
# as per your request to only modify this file.
set $skip_cache 0;
if ($http_cookie ~* "wordpress_logged_in_") {
    set $skip_cache 1;
}

# WordPress Admin, Login, and Cron - Never cache
location ~* /(wp-admin|wp-login|wp-cron)\.php$ {
    set $skip_cache 1;
    add_header Cache-Control "no-cache, no-store, must-revalidate, private";
    add_header Pragma "no-cache";
    try_files $uri $uri/ /index.php?$args;
}

# Static assets - Long cache (highest priority)
location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|webp|avif)$ {
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Vary "Accept-Encoding";
    try_files $uri =404;
}

# WordPress REST API - Short cache for public, no cache for logged-in
location ~* /wp-json/ {
    try_files $uri $uri/ /index.php?$args;
    if ($skip_cache = 0) {
        add_header Cache-Control "public, max-age=60, must-revalidate";
    }
    if ($skip_cache = 1) {
        add_header Cache-Control "no-cache, no-store, must-revalidate, private";
    }
}